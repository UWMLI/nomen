// Generated by CoffeeScript 1.7.1
(function() {
  'use strict';
  var Library;

  Library = (function() {
    function Library(datadir) {
      this.datadir = datadir;
      this.dir = "" + this.datadir + "/library";
    }

    Library.prototype.makeDir = function(callback) {
      return resolveLocalFileSystemURL(this.datadir, (function(_this) {
        return function(dir) {
          return dir.getDirectory('library', {
            create: true
          }, function() {
            return callback();
          });
        };
      })(this));
    };

    Library.prototype.deleteDir = function(callback) {
      return resolveLocalFileSystemURL(this.dir, (function(_this) {
        return function(dir) {
          return dir.removeRecursively(callback);
        };
      })(this), callback);
    };

    Library.prototype.deleteSet = function(id, callback) {
      return resolveLocalFileSystemURL("" + this.dir + "/" + id, (function(_this) {
        return function(dir) {
          return dir.removeRecursively(callback);
        };
      })(this), callback);
    };

    Library.prototype.makeSet = function(id, callback) {
      return this.deleteSet(id, (function(_this) {
        return function() {
          return resolveLocalFileSystemURL(_this.dir, function(dir) {
            return dir.getDirectory(id, {
              create: true
            }, function(dirEntry) {
              return callback(dirEntry);
            });
          });
        };
      })(this));
    };

    Library.prototype.scanLibrary = function(callback) {
      this.datasets = {};
      return resolveLocalFileSystemURL(this.dir, (function(_this) {
        return function(dirEntry) {
          var dirReader;
          dirReader = dirEntry.createReader();
          return getSubdirs(dirEntry.createReader(), function(dirs) {
            var processDirs;
            processDirs = function() {
              if (dirs.length === 0) {
                return callback();
              } else {
                return _this.addLibrary(dirs.pop(), processDirs);
              }
            };
            return processDirs();
          });
        };
      })(this), (function(_this) {
        return function() {
          return callback();
        };
      })(this));
    };

    Library.prototype.addLibrary = function(dirEntry, callback) {
      var ds;
      ds = new Dataset(dirEntry.toURL());
      return ds.loadInfo((function(_this) {
        return function() {
          _this.datasets[ds.id] = ds;
          return callback();
        };
      })(this));
    };

    return Library;

  })();

  window.Library = Library;

}).call(this);
